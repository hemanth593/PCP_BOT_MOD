<!DOCTYPE html>
<html>
<head>
<title>Findcolor — UoPilot</title>
<meta charset="UTF-8" />
<link rel="stylesheet" href="styles" />
</head>
<body>
<h1 id="firstHeading" class="firstHeading" lang="ru">Findcolor</h1>
	
	<h2><span id="Описание"></span><span class="mw-headline" id=".D0.9E.D0.BF.D0.B8.D1.81.D0.B0.D0.BD.D0.B8.D0.B5">Описание</span></h2>
<p><b>Findcolor</b> - ищет пиксели определённого цвета(-ов) в заданной прямоугольной области.
</p>
<h2><span id="Синтаксис"></span><span class="mw-headline" id=".D0.A1.D0.B8.D0.BD.D1.82.D0.B0.D0.BA.D1.81.D0.B8.D1.81">Синтаксис</span></h2>
<p>Привязка к окну: опционально.
<br />Работа со свернутым окном: Нет.
<br />Работа с перекрытым окном: Да. Привязка к окну обязательна.
</p>
<pre> set #a FindColor (StartX StartY EndX EndY ShiftX ShiftY (RequiredColor) ResultArray [type [count [deviation]]] [abs])
</pre>
<p>где:
<br />
<b>&lt;#a&gt;</b> - переменная, в которую записывается количество найденных пикселей (или код ошибки меньший нуля)<br />
<b>&lt;StartX StartY&gt;</b> - координаты левого верхнего угла области поиска<br />
<b>&lt;EndX EndY&gt;</b> - координаты правого нижнего угла области поиска<br />
<b>&lt;ShiftX ShiftY&gt;</b> - шаг поиска по осям X и Y соответственно. Почти всегда указывают равным "1".<br />
<b>&lt;(RequiredColors)&gt;</b> - один или несколько цветов для поиска (в круглых скобках!). Могут указываться отдельные RGB каналы и/или цвета в виде значений и/или диапазонов:<br />
</p>
<dl><dd>'84235' - точный десятичный цвет<br /></dd>
<dd>'84235-86027' - диапазон десятичных цветов<br /></dd>
<dd>'R(11)' - значение красного канала = 11, остальные каналы не проверяются<br /></dd>
<dd>'G(73-80)' - диапазон значений зеленого канала, остальные каналы не проверяются<br /></dd>
<dd>'R(11)+G(73-80)+B(1)' - заданы значения по всем каналам<br /></dd>
<dd>'84235, R(0), R(11)+G(73-80)+B(1)' - комбинированное указание искомых цветов<br /></dd></dl>
<p>Если в команде указывается только один десятичный цвет, то его (цвет) можно записывать без круглых скобок.<br />
<b>&lt;%ResultArray&gt;</b> - массив, в который записываются найденные значения. В каждую строку записываются координаты найденного пикселя. В 1-й колонке координата X, во 2-й координата Y, в третьей найденный цвет.<br />
<b>[type]</b> (необязательно) - тип поиска. Может принимать значения "1" (надежный), "2" (быстрый) или целое число означающее хендл окна, в котором нужно вести поиск. Как правило, чаще используют "2", он тоже отлично работает.<br />
Если вместо "2" или "1" указать "workwindow" (переменная содержащая хендл рабочего окна), то поиск будет происходить в привязанном рабочем окне (и в его относительных координатах). По сути, это третий тип поиска. При этом окно может быть частично или полностью закрыто другими окнами (но не свёрнуто!).<br />
<b>[count]</b> (необязательно)- количество найденных пикселей, после которых поиск прерывается. Если просто нужно определить наличие цвета в заданной области и не важно общее число таких пикселей, то можно указать "1" - и скорость работы команды будет оптимальной. Если параметр не указывать, то будет искаться максимальное число пикселей<br />
<b>[deviation]</b> (необязательно) - погрешность оттенка. Указывается в&#160;%. Например: есть погрешность 3%. Точка имеет цвет 100 120 130, 255*3%=7, соответственно 100+/-7. При этом все цвета в пределах (93 113 123)-(107 127 137) будут считаться совпадением.<br />
<b>[abs]</b> (необязательно) - этот параметр указывается, если вы ищете пиксели в координатах относительно верхнего левого угла экрана. Если не указывать параметр, то поиск будет идти в координатах рабочего окна текущего скрипта.
</p><p><b>Коды ошибок findcolor:</b><br />
'<b>-1'</b> упало при поиске, точная причина не известна<br />
'<b>-2'</b> не нашли открывающую скобку после имени функции<br />
'<b>-3'</b> (не используется)<br />
'<b>-4'</b> неправильно указан тип поиска, или хэндл = 0<br />
'<b>-5'</b> (не используется)<br />
'<b>-6'</b> ошибка получения изображения с экрана.
<br /><br />Иногда требуется сделать клик со смещением. Указывать можно как вначале скрипта так и перед функцией FindColor.
</p>
<pre>set findoffsetx 50    //смещение вправо на 50 пикселей
set findoffsety 30    //смещение вниз на 30 пикселей

set findoffsetx -40   //смещение влево на 40 пикселей
set findoffsety -60   //смещение вверх на 60 пикселей
</pre>
<h2><span id="Примеры"></span><span class="mw-headline" id=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.80.D1.8B">Примеры</span></h2>
<pre>// Пример 1
set #a findcolor ( 339 501 341 631 1 1 (207) %close 2 ) // поиск в рабочем окне
</pre>
<p>Этот пример означает следующее: в текущем рабочем окне в области с координатами (339,501)-(341,631) с шагом поиска (1,1) ищутся все пиксели с десятичным цветом 207. Все найденные координаты пикселей будут записаны в массив %close. Тип поиска = 2 (быстрый).<br />
В результате работы, если в данной области будет обнаружено 2 пикселя с цветом 207, то в элемент массива %close[1 1] будет записано значение координаты X для первого пикселя, в %close[1 2] будет записано значение координаты Y  для первого пикселя, в %close[2 1] - значение X для второго пикселя, в %close[2 2] - значение Y для второго пикселя,<br />
В #a будет записано число найденных пикселей = 2 (или 0, если бы такие пиксели не были найдены).
</p>
<pre>// Пример 2
set #b findcolor ( 339 501 341 631 1 1(207) %close 2 abs )     // поиск на экране
</pre>
<pre>// Пример 3
set #c findcolor ( 339 501 341 631 1 1 (207) %close workwindow )    // поиск в рабочем окне (даже в перекрытом)
</pre>
<pre>// Пример 4
set #d findcolor (403, 138 973, 502 1 1 (3949430) %arr 2)
if #d &gt; 0           // если найден нужный цвет, то делаем двойной левый клик мышкой в первой найденной точке
  double_left %arr [1 1], %arr [1 2]
else
  msg Цвет не найден!
end_if
</pre>
<pre>// Пример 5
// Использование отклонения цвета - deviation
set #d findcolor (403, 138 973, 502 1 1 (3949430) %arr 2 -1 3)   // 2 - это тип поиска
                                                                 // -1 - количество найденных пикселей (искать все)
                                                                 // 3 - погрешность оттенка
if #d &gt; 0           // если найден нужный цвет
  kleft %arr [1 1], %arr [1 2]
  wait 2000
else
  log Цвет не найден!
end_if
</pre>
<pre>// Пример 6
// Использование шага поиска
// Допустим, найти 2 одинаковых изображения в сетке 3*3.  
set #a findcolor (100 100 200 200 50 50 2366701 %a)    // проверить 9 точек на цвет 2366701
                                                       // координаты: 100 100, 150 100, 200 100
                                                       //             100 150, 150 150, 200 150
                                                       //             100 200, 150 200, 200 200                                                                   
log #a                              // вывод в лог количества найденных цветов
if #a &gt; 1                           // если найдено больше 1 точки
    for #i 1 size(%a)                
        log %a [#i 1] %a [#i 2]     // вывод в лог координат
        move %a [#i 1] %a [#i 2]    // переместит курсор на найденные точки
        wait 2000                   // ждать 2 секунды
    end_for  
end_if     
End_script
</pre>
<pre>// Пример 7
// Использование шага поиска
set #a findcolor (100 100 200 200 50 50 (0-16777215) %arr)    // получить цвета в 9 точках, сетка 3*3
                                                              // координаты: 100 100, 150 100, 200 100
                                                              //             100 150, 150 150, 200 150
                                                              //             100 200, 150 200, 200 200
save_array %arr C:\SaveColor.txt                              // сохранить массив с найденными координатами в файл 'C:\SaveColor.txt' 
End_script 
</pre>
<p><b>Примеры поиска цвета в перекрытом(не свёрнутом) окне:</b>
<br />Привязка к окну обязательна. Aero (темы Windows 7) должен быть включен. Если был установлен Астер, то он должен быть отключен, а система перезагружена.
<br />Окно может быть перекрыто полностью, частично или вообще не перекрыто. Может находиться за пределами экрана.
<br />Иногда требуется указывать родительское окно. В окне пилота есть кнопка 'F', при нажатии открывается окно, в котором отображается что "видит" пилот при поиске (Findcolor, Findimage). Если в окне "чёрный квадрат", значит указано не то окно. В Windows 10 работает не во всех приложениях, может потребоваться установка Aero Glass.
</p>
<pre>// Пример 8
set #a findcolor (0 0 1920 1080 1 1 (12146182) %arr workwindow )
log #a                 // если в логе 0, скорее всего, надо указать родительское окно
End_script
</pre>
<p>Учтите, при указании родительского окна в качестве рабочего, клики могут быть со смещением. Используйте поиск окна <a href="https://uopilot.uokit.com/wiki/index.php?title=Findwindow" title="Findwindow">Findwindow</a> и <a href="https://uopilot.uokit.com/wiki/index.php?title=%D0%9F%D0%BE%D0%B8%D1%81%D0%BA_%D0%BF%D1%83%D1%82%D0%B8_%D0%BA_%D0%B4%D0%BE%D1%87%D0%B5%D1%80%D0%BD%D0%B5%D0%BC%D1%83_%D0%BE%D0%BA%D0%BD%D1%83" title="Поиск пути к дочернему окну">Поиск пути к дочернему окну</a>.
</p>
<pre>// Пример 9
set #handle findwindow (Google)                // поиск окна с именем Google
set #a findcolor (100 100 1000 1000  (5482548 ) %arr #handle)
log #a                                         // количество найденных цветов
if #a &gt; 0                                      // если цвет найден 
     move %arr [1 1] %arr [1 2]                // переместить курсор на первый найденный цвет
end_if         
End_script 
</pre>
<pre>// Пример 10
set #handle findwindow (lineage2)
set #a findcolor (18 17  243 37 1 1 (23176) %arr #handle)
log #a                 // количество найденных цветов        
End_script 
</pre>
<h2><span id="Смотрите_также"></span><span class="mw-headline" id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5">Смотрите также</span></h2>
<p><a href="https://uopilot.uokit.com/wiki/index.php?title=Findimage" title="Findimage">Findimage</a>
<br /><a href="https://uopilot.uokit.com/wiki/index.php?title=If" title="If">If</a>
<br /><a href="https://uopilot.uokit.com/wiki/index.php?title=Get_color" title="Get color">Get color</a>
<br /><a href="https://uopilot.uokit.com/wiki/index.php?title=Color" title="Color">Color</a>
</p>
<h2><span id="История_развития"></span><span class="mw-headline" id=".D0.98.D1.81.D1.82.D0.BE.D1.80.D0.B8.D1.8F_.D1.80.D0.B0.D0.B7.D0.B2.D0.B8.D1.82.D0.B8.D1.8F">История развития</span></h2>
<p><b>2.17</b>
<br />Добавил функцию поиска точек определенного цвета в заданной области. Возвращает количество найденных элементов. В параметр 'ResultArray' заносятся их координаты.
</p>
<pre>findcolor (StartX StartY EndX EndY ShiftX ShiftY (RequiredColor) ResultArray [type] [abs])
</pre>
<p>где 'type':
<br />1 - обычный способ (по умолчанию)
<br />2 - альтернативный
Пример:
</p>
<pre>set $a findcolor (0, 0 1024, 3  1 1 (10243328) %s 2)
set #w size (%s)
msg size: #w  found: $a
for #i 1 #w
    set #x %s [#i 1]
    set #y %s [#i 2]
end_for
</pre>
<p><b>2.18</b>
<br />Исправил 'FindColor' для работы с линейкой.
</p><p><b>2.19</b>
<br />Поправил задание цвета в findcolor с помощью переменной.
<br />Ускорил findcolor.
<br />Отключил преобразование найденных координат в относительные для клиентского окна в альтернативном способе поиска цвета в 'findcolor'.
</p><p><b>2.20</b>
<br />
При ошибке альтернативного определения цвета в 'findcolor', в строковой переменной будет возвращено значение '-3' (ранее возвращалось что-то типа '0---'). Отрицательные значения в принципе сигнализируют об ошибке.
<br />Отныне 'findcolor' ищет во всем указанном диапазоне, а не 'до' конечной точки. 'set $a FindColor (10, 15  10, 15  1 1  84235  %arr)' будет искать цвет в одной точке.
<br />Научил 'findcolor' искать по диапазону цветов и по отдельным каналам цвета. Для поиска по диапазону параметры цвета задаются в круглых скобках. Можно задавать сразу несколько параметров. Ищет сразу по всем указанным параметрам. если цвет указан без скобок, то ищется точное совпадение цвета, как раньше.
</p>
<pre>'set $a FindColor (StartX StartY EndX EndY ShiftX ShiftY (RequiredColor) ResultArray [type] [abs])'
</pre>
<p>Примеры задания 'RequiredColor':
</p>
<pre>       '84235' - точный цвет
       '84235-86027' - диапазон цветов
       'R(11)' - значение красного канала = 11, остальные не проверяются
       'G(73-80)' - диапазон значений зеленого канала, остальные не проверяются
       'R(11)+G(73-80)+B(1)' - заданы значения по всем каналам
       '84235, R(0), R(11)+G(73-80)+B(1)' - комбинированное указание искомых цветов
</pre>
<p>Добавил предельное количество точек для поиска в команде 'findcolor', в связи с этим слегка изменился синтаксис:
</p>
<pre>'set $a FindColor (StartX StartY EndX EndY ShiftX ShiftY (RequiredColor) ResultArray [type [count]] [abs])'
</pre>
<p><b>2.23</b>
<br />Поправил возвращаемый размер массива в 'findcolor' при ошибке поиска с результатом -1.
</p><p><b>2.25</b>
<br />Переделал 'printscreen' и 'findcolor'. Повысил стабильность работы.
</p><p><b>2.27</b>
<br />Научил 'findcolor' искать цвет в перекрытых окнах. Ищет не на всем экране, а в конкретном указанном окне. Хэндл окна указывается в качестве типа поиска.
</p><p><b>2.27.1</b>
<br />Подправил поиск в перекрытых окнах в командах 'findimage', 'findcolor'.
</p><p><b>2.27.2</b>
<br />Добавил код ошибки -4 в команде 'findcolor' - неправильно указан тип поиска, либо не выбрано рабочее окно.
</p><p><b>2.32</b>
<br />Добавил задание диапазона цветов с помощью переменных в команде 'findcolor (725 48 813 123 1 1 (#color2a-#color2b) %Centr2 2).
<br />Добавил в 'findcolor' погрешность оттенка. Указывается в&#160;%. Слегка изменился синтаксис команды.
пример: есть погрешность 3%. точка имеет цвет 100 120 130, 255*3%=7, соответственно 100+/-7. При этом все цвета в пределах (93 113 123)-(107 127 137) будут считаться совпадением.
<br />Для учета погрешности оттенка, цвет должен быть указан в скобках, иначе погрешность будет проигнорирована.
</p>
<pre>set $a FindColor (StartX StartY EndX EndY ShiftX ShiftY (RequiredColor) ResultArray [type [count [deviation]]] [abs])
</pre>
<p>Исправил указание цвета с помощью переменных в конструкциях типа 'set $a findcolor (4, 1 13, 38 1 1 (B(#i)) %watch 2)'.
</p><p><b>2.33</b>
<br />Починил 'deviation' в 'findcolor'.
<br />Исправил падение команды 'findcolor'. Исправил утечки памяти.
</p><p><b>2.34</b>
<br />Исправил 'findimage' и 'findcolor'. Возвращали неправильные координаты по Y. Ищет слева снизу - вправо вверх.
</p><p><b>2.35</b>
<br />Исправил 'findimage' и 'findcolor'. Возвращали неправильные координаты.
</p><p><b>2.36</b>
<br />Добавил кнопочку "F", открывающую тестовую формочку с изображением, найденным Findcolor.
<br />Добавил возврат найденного цвета в третьем элементе массива в команде 'findcolor'.
<br />Добавил переменные смещения возвращаемых координат команд 'findimage' и 'findcolor': 
</p>
<pre>'findoffsetx',  'findoffsety'
</pre>
<p><b>2.38</b>
<br />Исправил команду 'findcolor'. При поиске по хэндлу возвращал неправильную координату "y" (вычитал стартовую).
</p><p><b>2.39</b>
<br />Вынес 'findcolor' из потока пилота, теперь оно меньше подтормаживает сам пилот.
<br />Исправил ошибку в разборе строки диапазонов цветов, указанных в 'findcolor', когда лишние пробелы вокруг "-" приводили к недопониманию.
</p><p><b>2.41</b>
<br />Добавил в функцию 'findcolor' поиск цвета в загруженной области.
<br />Исправил в функции 'findcolor' поиск цвета в загруженной области.
</p>





		
		
		
		<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a  title="Служебная:Категории">Категория</a>: <ul><li><a  class="new" title="Категория:Поиск изображений (страница не существует)">Поиск изображений</a></li></ul>
		
		<div class="visualClear"></div>
		
	</div>
</div>

		
<br>
<div class="printfooter">Источник — <a dir="ltr" href="https://uopilot.uokit.com/wiki/index.php?title=Findcolor&amp;oldid=554">https://uopilot.uokit.com/wiki/index.php?title=Findcolor&amp;oldid=554</a></div></body>
</html>
 